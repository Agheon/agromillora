<!DOCTYPE html>
<html lang="es">
<head>
    {{! Document Layout}}
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Agromillora</title>
    <link rel="stylesheet" href="/public/css/bootstrap.materia.min.css">
    <link rel="stylesheet" href="/public/css/toastr.min.css">
    <link rel="stylesheet" href="/public/fontawesome/css/fontawesome-all.min.css">
    <link rel="stylesheet" href="/public/css/select2.min.css">
    <link rel="stylesheet" href="/public/jquery-ui-1.12.1/jquery-ui.min.css">
    <link rel="stylesheet" href="/public/css/dataTables.searchHighlight.css">
    <link rel="stylesheet" href="/public/css/animate.min.css">
    <link rel="stylesheet" href="/public/css/datatables.min.css"/>
    <link rel="stylesheet" href="/public/css/daterangepicker.css">
    <link rel="stylesheet" href="/public/css/toastr.min.css">
    <link rel="stylesheet" href="/public/css/sweetalert2.css">

    <style>
        .toast {
           opacity: 1.0 !important;
        }

        .user {
            font-size: 20px;
        }

        .logo {
            max-width:65px;
        }

        .white-text {
            color:white !important;
        }

        ::placeholder { /* Chrome, Firefox, Opera, Safari 10.1+ */
            color: #b2bec3 !important;
            opacity: 1; /* Firefox */
        }

        :-ms-input-placeholder { /* Internet Explorer 10-11 */
            color: #b2bec3 !important;
        }

        ::-ms-input-placeholder { /* Microsoft Edge */
            color: #b2bec3 !important;
        }

        .btn.btn-circle {
            padding: 0;
            border-radius: 50%;
        }
    </style>
    {{#block "css"}}
    {{/block}}

</head>

<body>
    
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <a class="navbar-brand" href="/"><img class="logo" src="/public/img/logo.png" alt=""></a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarColor02" aria-controls="navbarColor02" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        
        <div class="collapse navbar-collapse" id="navbarColor02">
            <ul class="navbar-nav mr-auto">
                <li class="nav-item active">
                    <a id="budget-link" class="nav-link" href="/budget"><i class="fas fa-file-alt"></i>&nbsp; Presupuestos <span class="sr-only">(current)</span></a>
                </li>
                <li class="nav-item">
                    <a id="products-link" class="nav-link" href="/products"><i class="fab fa-pagelines"></i>&nbsp; Productos</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#"><i class="fas fa-money-check-alt"></i>&nbsp; Pagos recibidos</a>
                </li>
                <li class="nav-item">
                    <a id="logs-link" class="nav-link" href="/logs"><i class="fas fa-align-left"></i>&nbsp; Logs</a>
                </li>
            </ul>
            <div class="form-inline my-2 my-lg-0 white-text">
                <h5 style="text-transform: capitalize;"><i class="fas fa-user"></i>&nbsp;{{{ credentials.name }}} {{{ credentials.lastname }}}&nbsp;<a style="color:#F44336;" href="/logout"><i class="fas fa-times"></i></a></h5>
            </div>
        </div>
    </nav>

    <div class="container-fluid">
        {{{ content }}}
    </div>
    

    <script src="/public/js/jquery-1.12.4.min.js"></script>
    <script src="/public/js/popper.min.js"></script>
    <script src="/public/js/bootstrap.min.js"></script>
    <script src="/public/js/select2.min.js"></script>
    <script src="/public/js/pdfmake.min.js"></script>
    <script src="/public/js/vfs_fonts.js"></script>
    <script src="/public/js/datatables.min.js"></script>
    <script src="/public/js/jquery.rut.min.js"></script>
    <script src="/public/js/moment.js"></script>
    <script src="/public/js/daterangepicker.js"></script>
    <script src="/public/js/toastr.min.js"></script>
    <script src="/public/js/sweetalert2.js"></script>
    <script> 
        
        const ajax = ({type, url, data}) => {
            return new Promise((resolve, reject)=>{
                let options = {
                    url
                };
                if(!type){
                    options.type = 'GET';
                } else {
                    options.type = type;
                }
                if(data) options.data = data;
                $.ajax(options)
                .done((result) => {
                    resolve(result);
                })
                .fail(() => {
                    reject({error: 'ERROR IN --> '+url+' <--'});
                });
            });
        };

        const isEmail = (email) => {
            let regexEmail = /^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/;
            return regexEmail.test(email);
        }
        
        const cleanRut = (rut) => {
            var replace1 = rut.split('.').join('');
            var replace2 = replace1.replace('-', '');
            return replace2;
        }

        const rutFunc = (rut) => {
            return $.formatRut(rut)
        }

        const checkSession = () => {
            $.ajax({
                url: '/check'
            })
            .done(function(data) {
                if(data != true) reloadPage();
            })
            .fail(function() {
                reloadPage();
            });
        }

        const reloadPage = () => {
            swal({
                title: 'Su sesión a finalizado',
                text: 'Redirigiendo a página de inicio de sesión...',
                type: 'warning',
                showCancelButton: false,
                showConfirmButton: false,
                animation: true
            });

            setTimeout(() => {
                //window.location.replace("/login");
                location.reload();
            }, 5000);
        }

        const getTime = () => {
            return new Promise(resolve=>{
                ajax({url: 'api/tools/getServerTime'}).then(data=>{
                resolve(data);
                })
            })
        };


        function capitalizeAll(val) {
            return (val ? val.toLowerCase() : val).replace(/(?:^|\s)\S/g, function(a) { return a.toUpperCase(); });
        }

        function capitalizeFirst(val) {
            return val.substr(0,1).toUpperCase() + val.substr(1).toLowerCase();
        }
        
        function removeExtraSpaces(val) {
            return val.replace(/\s+/g, ' ').trim()
        }

        function removeCommas(amount) {
            let replace = amount.split(',').join('');
            return parseInt(replace);
        }

        const number_format = (amount, decimals) => {
            amount += ''; // por si pasan un numero en vez de un string
            amount = parseFloat(amount.replace(/[^0-9\.]/g, '')); // elimino cualquier cosa que no sea numero o punto

            decimals = decimals || 0; // por si la variable no fue fue pasada

            // si no es un numero o es igual a cero retorno el mismo cero
            if (isNaN(amount) || amount === 0)
                return parseFloat(0).toFixed(decimals);

            // si es mayor o menor que cero retorno el valor formateado como numero
            amount = '' + amount.toFixed(decimals);

            var amount_parts = amount.split('.'),
                regexp = /(\d+)(\d{3})/;

            while (regexp.test(amount_parts[0]))
                amount_parts[0] = amount_parts[0].replace(regexp, '$1' + '.' + '$2');

            return amount_parts.join('.');
        }

        const comma_format = (amount, decimals) => {
            amount += ''; // por si pasan un numero en vez de un string
            amount = parseFloat(amount.replace(/[^0-9\,]/g, '')); // elimino cualquier cosa que no sea numero o punto

            decimals = decimals || 0; // por si la variable no fue fue pasada

            // si no es un numero o es igual a cero retorno el mismo cero
            if (isNaN(amount) || amount === 0)
                return parseFloat(0).toFixed(decimals);

            // si es mayor o menor que cero retorno el valor formateado como numero
            amount = '' + amount.toFixed(decimals);

            var amount_parts = amount.split(','),
                regexp = /(\d+)(\d{3})/;

            while (regexp.test(amount_parts[0]))
                amount_parts[0] = amount_parts[0].replace(regexp, '$1' + ',' + '$2');

            return amount_parts.join(',');
        }
    </script>
    {{#block "js"}}
    {{/block}}
</body>
</html>